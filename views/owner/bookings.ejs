<% layout("/layouts/boilerplate") %>

<div class="container my-4">

  
  <h2 class="fw-bold mb-3 text-center">My Property Bookings</h2>


  <div class="table-responsive d-none d-md-block shadow rounded">
    <table class="table table-bordered table-striped align-middle text-center">
      <thead class="table-dark">
        <tr>
          <th>User</th>
          <th>Listing</th>
          <th>Check In</th>
          <th>Check Out</th>
          <th>Adults</th>
          <th>Children</th>
          <th>Total Price</th>
          <th>Action</th>
        </tr>
      </thead>

      <tbody>
        <% bookings.forEach(b => { %>
        <tr>
          <td><%= b.user ? b.user.username : "Deleted User" %></td>

          <td>
            <% if(b.listing){ %>
              <%= b.listing.title %>
            <% } else { %>
              <span class="text-danger">Deleted Listing</span>
            <% } %>
          </td>

          <td><%= new Date(b.checkIn).toDateString() %></td>
          <td><%= new Date(b.checkOut).toDateString() %></td>

          
          <td><%= b.adults || 1 %></td>
          <td><%= b.children || 0 %></td>

          <td class="fw-bold text-success">₹<%= b.totalPrice %></td>

          <td>
            <form action="/bookings/<%= b._id %>?_method=DELETE" method="POST">
              <button class="btn btn-danger btn-sm w-100"
                onclick="return confirm('Cancel this booking?')">
                Cancel
              </button>
            </form>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
  </div>


  <div class="d-block d-md-none">
    <% bookings.forEach(b => { %>
      <div class="card shadow mb-3">
        <div class="card-body">

          <h5 class="fw-bold">
            <% if(b.listing){ %>
              <%= b.listing.title %>
            <% } else { %>
              <span class="text-danger">Deleted Listing</span>
            <% } %>
          </h5>

          <p class="mb-1"><strong>User:</strong> <%= b.user ? b.user.username : "Deleted User" %></p>
          <p class="mb-1"><strong>Check In:</strong> <%= new Date(b.checkIn).toDateString() %></p>
          <p class="mb-1"><strong>Check Out:</strong> <%= new Date(b.checkOut).toDateString() %></p>

    
          <p class="mb-1"><strong>Adults:</strong> <%= b.adults || 1 %></p>
          <p class="mb-1"><strong>Children:</strong> <%= b.children || 0 %></p>

          <p class="mb-2 fw-bold text-success">Total: ₹<%= b.totalPrice %></p>

          <form action="/bookings/<%= b._id %>?_method=DELETE" method="POST">
            <button class="btn btn-danger w-100"
              onclick="return confirm('Cancel this booking?')">
              Cancel Booking
            </button>
          </form>

        </div>
      </div>
    <% }) %>
  </div>

</div>


<div class="text-center mb-3">
  <a href="/listings" class="btn btn-secondary px-4">
    ⬅ Back
  </a>
</div>
